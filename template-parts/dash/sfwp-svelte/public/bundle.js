var app=function(){"use strict";function e(){}function t(e,t){for(const s in t)e[s]=t[s];return e}function s(e){return e()}function r(){return Object.create(null)}function n(e){e.forEach(s)}function a(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function o(e,t){e.appendChild(t)}function c(e,t,s){e.insertBefore(t,s||null)}function l(e){e.parentNode.removeChild(e)}function u(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function _(){return d(" ")}function m(e,t,s,r){return e.addEventListener(t,s,r),()=>e.removeEventListener(t,s,r)}function b(e,t){t=""+t,e.data!==t&&(e.data=t)}let f;function p(e){f=e}const g=[],h=Promise.resolve();let y=!1;const v=[],$=[],w=[];function x(e){$.push(e)}function k(){const e=new Set;do{for(;g.length;){const e=g.shift();p(e),N(e.$$)}for(;v.length;)v.shift()();for(;$.length;){const t=$.pop();e.has(t)||(t(),e.add(t))}}while(g.length);for(;w.length;)w.pop()();y=!1}function N(e){e.fragment&&(e.update(e.dirty),n(e.before_render),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_render.forEach(x))}let C;function S(e,t,r){const{fragment:i,on_mount:o,on_destroy:c,after_render:l}=e.$$;i.m(t,r),x(()=>{const t=o.map(s).filter(a);c?c.push(...t):n(t),e.$$.on_mount=[]}),l.forEach(x)}function q(e,t){e.$$.dirty||(g.push(e),y||(y=!0,h.then(k)),e.$$.dirty=r()),e.$$.dirty[t]=!0}function E(t,s,a,i,o,c){const l=f;p(t);const u=s.props||{},d=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:o,bound:r(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(l?l.$$.context:[]),callbacks:r(),dirty:null};let _=!1;var m;d.ctx=a?a(t,u,(e,s)=>{d.ctx&&o(d.ctx[e],d.ctx[e]=s)&&(d.bound[e]&&d.bound[e](s),_&&q(t,e))}):u,d.update(),_=!0,n(d.before_render),d.fragment=i(d.ctx),s.target&&(s.hydrate?d.fragment.l((m=s.target,Array.from(m.childNodes))):d.fragment.c(),s.intro&&t.$$.fragment.i&&t.$$.fragment.i(),S(t,s.target,s.anchor),k()),p(l)}class z{$destroy(){var t,s;s=!0,(t=this).$$&&(n(t.$$.on_destroy),t.$$.fragment.d(s),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={}),this.$destroy=e}$on(e,t){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}$set(){}}function A(t){var s,r,a,i,f,p,g,h,y,v,$,w,x,k,N,C,S,q,E,z,A,L,j,O,T,H,M,B,P,U,I,R,F,G,J,K,Q,V,W,X,Y,Z,ee,te,se,re,ne,ae,ie,oe,ce,le,ue,de,_e,me,be,fe,pe,ge,he,ye,ve,$e,we,xe,ke,Ne,Ce,Se,qe,Ee,ze,Ae,De,Le,je,Oe,Te,He,Me,Be,Pe,Ue,Ie;return{c(){s=u("li"),r=u("section"),a=u("h1"),i=d(t.first_name),f=_(),p=d(t.last_name),g=_(),h=u("section"),y=u("div"),v=u("a"),$=d(t.email),x=_(),k=u("p"),(N=u("strong")).textContent="Subscribed:",C=_(),S=d(t.date_start),q=_(),E=u("p"),(z=u("strong")).textContent="Status:",A=_(),L=d(t.sub_status),j=_(),O=u("div"),T=u("div"),H=u("p"),M=d(t.address_one),B=_(),P=u("p"),U=d(t.address_two),I=_(),R=u("p"),F=d(t.city),G=_(),J=u("p"),K=d(t.country),Q=_(),V=u("p"),W=d(t.postcode),X=_(),Y=u("div"),Z=u("button"),ee=d("Save"),te=_(),se=u("button"),re=d("Cancel"),ne=_(),ae=u("button"),ie=d("Edit Address"),oe=_(),ce=u("div"),le=u("p"),(ue=u("strong")).textContent="Starting Issue:",de=_(),_e=d(t.start_issue),me=_(),be=u("p"),(fe=u("strong")).textContent="Access Ends:",pe=_(),ge=d(t.next_renewal_date),he=_(),ye=u("p"),(ve=u("strong")).textContent="Renewals:",$e=_(),we=d(t.renewals),xe=_(),ke=u("p"),(Ne=u("strong")).textContent="Username:",Ce=_(),Se=u("a"),qe=d(t.first_name),Ee=d(t.last_name),ze=d(t.sub_id),De=_(),Le=u("div"),je=u("button"),Oe=d("Cancel Subscription"),He=_(),(Me=u("p")).textContent="The subscriber will retain access to the online archive until their subscription expires. This is the same as removing ‘auto-renewal’.",Be=_(),(Pe=u("button")).textContent="+ More",a.className="svelte-r8skmg",v.href=w="mailto:"+t.email,v.className="svelte-r8skmg",k.className="svelte-r8skmg",E.className="svelte-r8skmg",y.className="subscriber-card__info-section subscriber-card__basic-info svelte-r8skmg",H.className="address-line svelte-r8skmg",P.className="address-line svelte-r8skmg",R.className="address-line svelte-r8skmg",J.className="address-line svelte-r8skmg",V.className="address-line svelte-r8skmg",T.className="address-inputs",Z.dataset.sub=t.sub_id,Z.dataset.stripe=t.stripe_customer_id,Z.id="address-save",Z.className="svelte-r8skmg",se.dataset.sub=t.sub_id,se.dataset.stripe=t.stripe_customer_id,se.id="address-cancel",se.className="svelte-r8skmg",ae.dataset.sub=t.sub_id,ae.dataset.stripe=t.stripe_customer_id,ae.id="address-edit",ae.className="svelte-r8skmg",Y.className="address-buttons svelte-r8skmg",O.className="subscriber-card__info-section subscriber-card__address svelte-r8skmg",le.className="svelte-r8skmg",be.className="svelte-r8skmg",ye.className="svelte-r8skmg",Se.href=Ae="https://stingingfly.org/wp-admin/user-edit.php?user_id="+t.wp_user_id,Se.className="svelte-r8skmg",ke.className="svelte-r8skmg",ce.className="subscriber-card__info-section subscriber-card__secondary-info svelte-r8skmg",je.disabled=Te="pending_cancellation"==t.sub_status,je.dataset.subid=t.sub_id,je.dataset.stripeid=t.stripe_customer_id,je.className="svelte-r8skmg",Me.className="svelte-r8skmg",Le.className="subscriber-card__info-section subscriber-card__cancel svelte-r8skmg",h.className="subscriber-card__info svelte-r8skmg",Pe.className="subscriber-card__more-button svelte-r8skmg",s.className="subscriber-card svelte-r8skmg",s.id=Ue="sub-"+t.sub_id,Ie=[m(Z,"click",t.handleAddressSave),m(se,"click",t.handleAddressCancel),m(ae,"click",t.handleAddressEdit),m(je,"click",t.handleSubCancel),m(Pe,"click",D)]},m(e,t){c(e,s,t),o(s,r),o(r,a),o(a,i),o(a,f),o(a,p),o(s,g),o(s,h),o(h,y),o(y,v),o(v,$),o(y,x),o(y,k),o(k,N),o(k,C),o(k,S),o(y,q),o(y,E),o(E,z),o(E,A),o(E,L),o(h,j),o(h,O),o(O,T),o(T,H),o(H,M),o(T,B),o(T,P),o(P,U),o(T,I),o(T,R),o(R,F),o(T,G),o(T,J),o(J,K),o(T,Q),o(T,V),o(V,W),o(O,X),o(O,Y),o(Y,Z),o(Z,ee),o(Y,te),o(Y,se),o(se,re),o(Y,ne),o(Y,ae),o(ae,ie),o(h,oe),o(h,ce),o(ce,le),o(le,ue),o(le,de),o(le,_e),o(ce,me),o(ce,be),o(be,fe),o(be,pe),o(be,ge),o(ce,he),o(ce,ye),o(ye,ve),o(ye,$e),o(ye,we),o(ce,xe),o(ce,ke),o(ke,Ne),o(ke,Ce),o(ke,Se),o(Se,qe),o(Se,Ee),o(Se,ze),o(h,De),o(h,Le),o(Le,je),o(je,Oe),o(Le,He),o(Le,Me),o(s,Be),o(s,Pe)},p(e,t){e.first_name&&b(i,t.first_name),e.last_name&&b(p,t.last_name),e.email&&b($,t.email),e.email&&w!==(w="mailto:"+t.email)&&(v.href=w),e.date_start&&b(S,t.date_start),e.sub_status&&b(L,t.sub_status),e.address_one&&b(M,t.address_one),e.address_two&&b(U,t.address_two),e.city&&b(F,t.city),e.country&&b(K,t.country),e.postcode&&b(W,t.postcode),e.sub_id&&(Z.dataset.sub=t.sub_id),e.stripe_customer_id&&(Z.dataset.stripe=t.stripe_customer_id),e.sub_id&&(se.dataset.sub=t.sub_id),e.stripe_customer_id&&(se.dataset.stripe=t.stripe_customer_id),e.sub_id&&(ae.dataset.sub=t.sub_id),e.stripe_customer_id&&(ae.dataset.stripe=t.stripe_customer_id),e.start_issue&&b(_e,t.start_issue),e.next_renewal_date&&b(ge,t.next_renewal_date),e.renewals&&b(we,t.renewals),e.first_name&&b(qe,t.first_name),e.last_name&&b(Ee,t.last_name),e.sub_id&&b(ze,t.sub_id),e.wp_user_id&&Ae!==(Ae="https://stingingfly.org/wp-admin/user-edit.php?user_id="+t.wp_user_id)&&(Se.href=Ae),e.sub_status&&Te!==(Te="pending_cancellation"==t.sub_status)&&(je.disabled=Te),e.sub_id&&(je.dataset.subid=t.sub_id),e.stripe_customer_id&&(je.dataset.stripeid=t.stripe_customer_id),e.sub_id&&Ue!==(Ue="sub-"+t.sub_id)&&(s.id=Ue)},i:e,o:e,d(e){e&&l(s),n(Ie)}}}function D(e){let t=e.target,s=e.target.parentNode;s.classList.contains("expanded")?(s.classList.remove("expanded"),t.textContent="+ More",s.style.width="185px",s.style.height="185px"):(s.style.width="100%",s.style.height="auto",s.classList.add("expanded"),t.textContent="- Less")}function L(e,t,s){let r,{sub_id:n,first_name:a,last_name:i,email:o,address_one:c,address_two:l,city:u,country:d,postcode:_,stripe_customer_id:m,wp_user_id:b,sub_status:f,subscribe_until:p,date_start:g,next_renewal_date:h,renewals:y,gift:v,start_issue:$,delivery_region:w,gifter_first_name:x,gifter_last_name:k,gifter_email:N}=t,C=[];r="stingingfly.org"===window.location.hostname?"https://stingingfly.org/stripe/api":"https://sfwp.test/stripe/api",s("loc",r);let S=function(e,t=r){var s=new URL(t);return Object.keys(e).forEach(t=>s.searchParams.append(t,e[t])),s.href};return e.$set=(e=>{"sub_id"in e&&s("sub_id",n=e.sub_id),"first_name"in e&&s("first_name",a=e.first_name),"last_name"in e&&s("last_name",i=e.last_name),"email"in e&&s("email",o=e.email),"address_one"in e&&s("address_one",c=e.address_one),"address_two"in e&&s("address_two",l=e.address_two),"city"in e&&s("city",u=e.city),"country"in e&&s("country",d=e.country),"postcode"in e&&s("postcode",_=e.postcode),"stripe_customer_id"in e&&s("stripe_customer_id",m=e.stripe_customer_id),"wp_user_id"in e&&s("wp_user_id",b=e.wp_user_id),"sub_status"in e&&s("sub_status",f=e.sub_status),"subscribe_until"in e&&s("subscribe_until",p=e.subscribe_until),"date_start"in e&&s("date_start",g=e.date_start),"next_renewal_date"in e&&s("next_renewal_date",h=e.next_renewal_date),"renewals"in e&&s("renewals",y=e.renewals),"gift"in e&&s("gift",v=e.gift),"start_issue"in e&&s("start_issue",$=e.start_issue),"delivery_region"in e&&s("delivery_region",w=e.delivery_region),"gifter_first_name"in e&&s("gifter_first_name",x=e.gifter_first_name),"gifter_last_name"in e&&s("gifter_last_name",k=e.gifter_last_name),"gifter_email"in e&&s("gifter_email",N=e.gifter_email)}),{sub_id:n,first_name:a,last_name:i,email:o,address_one:c,address_two:l,city:u,country:d,postcode:_,stripe_customer_id:m,wp_user_id:b,sub_status:f,subscribe_until:p,date_start:g,next_renewal_date:h,renewals:y,gift:v,start_issue:$,delivery_region:w,gifter_first_name:x,gifter_last_name:k,gifter_email:N,handleAddressSave:async function(e){let t=e.target.dataset.sub,s=document.querySelector(`#sub-${t}`),r=s.querySelectorAll(".address-inputs input"),n=["address_one","address_two","city","country","postcode"],a={sub_id:t};"null"!=e.target.dataset.stripe&&(a.stripe_customer_id=e.target.dataset.stripe),s.querySelector("#address-edit").style.display="inline",s.querySelector("#address-cancel").style.display="none",s.querySelector("#address-save").style.display="none",r.forEach((e,t)=>{a[n[t]]=e.value;let s=e.parentNode,r=document.createElement("p");r.style.fontSize="12px",r.style.lineHeight="18px",r.style.margin=0,r.textContent=e.value,e.remove(),s.appendChild(r)});let i=await fetch(S(a),{method:"PUT"}),o=await i.json();console.log({data:o})},handleAddressCancel:function(e){let t=e.target.dataset.sub,s=document.querySelector(`#sub-${t}`),r=s.querySelectorAll(".address-inputs input");s.querySelector("#address-edit").style.display="inline",s.querySelector("#address-cancel").style.display="none",s.querySelector("#address-save").style.display="none",r.forEach((e,t)=>{e.value;let s=e.parentNode,r=document.createElement("p");r.style.fontSize="12px",r.style.lineHeight="18px",r.style.margin=0,r.textContent=C[t],e.remove(),s.appendChild(r)})},handleAddressEdit:function(e){let t=e.target.dataset.sub,s=document.querySelector(`#sub-${t}`),r=s.querySelectorAll(".address-inputs p");e.target.style.display="none",s.querySelector("#address-cancel").style.display="inline",s.querySelector("#address-save").style.display="inline",r.forEach(e=>{let t=e.textContent,s=e.parentNode,r=document.createElement("input");r.value=t,r.style.fontSize="12px",r.style.lineHeight="14px",r.style.padding="3px",r.style.display="block",r.style.margin="2px 0",C.push(t),e.remove(),s.appendChild(r)})},handleSubCancel:async function(e){let t={sub_id:e.target.dataset.subid};"null"!=e.target.dataset.stripeid&&(t.stripe_customer_id=e.target.dataset.stripeid);let s=await fetch(S(t),{method:"DELETE"}),r=await s.json();"success"===r.status_code?(e.target.setAttribute("disabled",!0),e.target.textContent="Subscription Cancelled"):e.target.parentNode.querySelector("p").textContent=r.message;console.log(r)}}}class j extends z{constructor(e){super(),E(this,e,L,A,i,["sub_id","first_name","last_name","email","address_one","address_two","city","country","postcode","stripe_customer_id","wp_user_id","sub_status","subscribe_until","date_start","next_renewal_date","renewals","gift","start_issue","delivery_region","gifter_first_name","gifter_last_name","gifter_email"])}}function O(e,t,s){const r=Object.create(e);return r.sub=t[s],r}function T(e){var s,r=[e.sub];let n={};for(var a=0;a<r.length;a+=1)n=t(n,r[a]);var i=new j({props:n});return{c(){i.$$.fragment.c()},m(e,t){S(i,e,t),s=!0},p(e,t){var s=e.subsData?function(e,t){const s={},r={},n={$$scope:1};let a=e.length;for(;a--;){const i=e[a],o=t[a];if(o){for(const e in i)e in o||(r[e]=1);for(const e in o)n[e]||(s[e]=o[e],n[e]=1);e[a]=o}else for(const e in i)n[e]=1}for(const e in r)e in s||(s[e]=void 0);return s}(r,[t.sub]):{};i.$set(s)},i(e){s||(i.$$.fragment.i(e),s=!0)},o(e){i.$$.fragment.o(e),s=!1},d(e){i.$destroy(e)}}}function H(e){for(var t,s,r=e.subsData,a=[],i=0;i<r.length;i+=1)a[i]=T(O(e,r,i));function o(e,t,s){var r;a[e]&&(t&&(r=(()=>{a[e].d(t),a[e]=null}),C.callbacks.push(r)),a[e].o(s))}return{c(){t=u("ul");for(var e=0;e<a.length;e+=1)a[e].c();t.className="svelte-jh0twj"},m(e,r){c(e,t,r);for(var n=0;n<a.length;n+=1)a[n].m(t,null);s=!0},p(e,s){if(e.subsData){r=s.subsData;for(var i=0;i<r.length;i+=1){const n=O(s,r,i);a[i]?(a[i].p(e,n),a[i].i(1)):(a[i]=T(n),a[i].c(),a[i].i(1),a[i].m(t,null))}for(C={remaining:0,callbacks:[]};i<a.length;i+=1)o(i,1,1);C.remaining||n(C.callbacks)}},i(e){if(!s){for(var t=0;t<r.length;t+=1)a[t].i();s=!0}},o(e){a=a.filter(Boolean);for(let e=0;e<a.length;e+=1)o(e,0);s=!1},d(e){e&&l(t),function(e,t){for(let s=0;s<e.length;s+=1)e[s]&&e[s].d(t)}(a,e)}}}function M(e,t,s){let{subsData:r}=t;return e.$set=(e=>{"subsData"in e&&s("subsData",r=e.subsData)}),{subsData:r}}class B extends z{constructor(e){super(),E(this,e,M,H,i,["subsData"])}}const P=function(){const{subscribe:t,set:s,update:r}=function(t,s=e){let r;const n=[];function a(e){if(i(t,e)){if(t=e,!r)return;n.forEach(e=>e[1]()),n.forEach(e=>e[0](t))}}return{set:a,update:function(e){a(e(t))},subscribe:function(i,o=e){const c=[i,o];return n.push(c),1===n.length&&(r=s(a)||e),i(t),()=>{const e=n.indexOf(c);-1!==e&&n.splice(e,1),0===n.length&&r()}}}}([]);let n;return n="stingingfly.org"===window.location.hostname?"https://stingingfly.org/stripe/api":"https://sfwp.test/stripe/api",{subscribe:t,filter:e=>fetch(n,{cache:"force-cache"}).then(e=>e.json()).then(t=>t.filter(t=>{if(`${t.first_name} ${t.last_name} ${t.email}`.toLowerCase().includes(e.toLowerCase()))return!0})).then(e=>s(e)),generalSort:e=>r(t=>(function(e,t){return e.sort((e,s)=>e[t]?e[t].localeCompare(s[t]):-1)})(t,e)),remote:e=>s(e)}}();function U(t){var s,r,a,i,f,p,g,h,y,v,$,w,x,k,N,C,S,q,E,z,A,D,L,j,O,T;return{c(){var e,n,o;s=u("header"),r=u("h1"),a=d(t.number),i=d(" Subscribers"),f=_(),p=u("div"),g=u("div"),(h=u("label")).textContent="Search Subscribers:",y=_(),v=u("input"),$=_(),w=u("div"),(x=u("span")).innerHTML="<strong>Order By:</strong>",k=_(),(N=u("button")).textContent="Name",C=_(),(S=u("button")).textContent="Email",q=_(),(E=u("button")).textContent="Date Subscribed",z=_(),(A=u("button")).textContent="Starting Issue",D=_(),(L=u("button")).textContent="Status",j=_(),(O=u("button")).textContent="Gift",h.htmlFor="sub-search-input",h.className="svelte-zvecq4",v.id="sub-search-input",e=v,n="type",null==(o="text")?e.removeAttribute(n):e.setAttribute(n,o),v.className="svelte-zvecq4",g.className="filter svelte-zvecq4",x.className="svelte-zvecq4",N.className="sub-sort-button svelte-zvecq4",N.dataset.key="first_name",S.className="sub-sort-button svelte-zvecq4",S.dataset.key="email",E.className="sub-sort-button svelte-zvecq4",E.dataset.key="date_start",A.className="sub-sort-button svelte-zvecq4",A.dataset.key="start_issue",L.className="sub-sort-button svelte-zvecq4",L.dataset.key="sub_status",O.className="sub-sort-button svelte-zvecq4",O.dataset.key="gift",w.className="sort svelte-zvecq4",p.className="filter-bar svelte-zvecq4",s.className="svelte-zvecq4",T=[m(v,"input",I),m(N,"click",R),m(S,"click",R),m(E,"click",R),m(A,"click",R),m(L,"click",R),m(O,"click",R)]},m(e,t){c(e,s,t),o(s,r),o(r,a),o(r,i),o(s,f),o(s,p),o(p,g),o(g,h),o(g,y),o(g,v),o(p,$),o(p,w),o(w,x),o(w,k),o(w,N),o(w,C),o(w,S),o(w,q),o(w,E),o(w,z),o(w,A),o(w,D),o(w,L),o(w,j),o(w,O)},p(e,t){e.number&&b(a,t.number)},i:e,o:e,d(e){e&&l(s),n(T)}}}function I(e){let t=e.target.value;P.filter(t)}function R(e){let t=e.target.dataset.key.toLowerCase();P.generalSort(t)}function F(e,t,s){let{number:r}=t;return e.$set=(e=>{"number"in e&&s("number",r=e.number)}),{number:r}}class G extends z{constructor(e){super(),E(this,e,F,U,i,["number"])}}function J(e){var t,s,r=new G({props:{number:e.$subscribers.length}}),n=new B({props:{subsData:e.$subscribers}});return{c(){r.$$.fragment.c(),t=_(),n.$$.fragment.c()},m(e,a){S(r,e,a),c(e,t,a),S(n,e,a),s=!0},p(e,t){var s={};e.$subscribers&&(s.number=t.$subscribers.length),r.$set(s);var a={};e.$subscribers&&(a.subsData=t.$subscribers),n.$set(a)},i(e){s||(r.$$.fragment.i(e),n.$$.fragment.i(e),s=!0)},o(e){r.$$.fragment.o(e),n.$$.fragment.o(e),s=!1},d(e){r.$destroy(e),e&&l(t),n.$destroy(e)}}}function K(e,t,s){let r,n;return function(e,t,s){const r=t.subscribe(s);e.$$.on_destroy.push(r.unsubscribe?()=>r.unsubscribe():r)}(e,P,e=>{s("$subscribers",r=e)}),"stingingfly.org"===window.location.hostname?s("url",n="https://stingingfly.org/stripe/api"):s("url",n="https://sfwp.test/stripe/api"),fetch(n,{cache:"no-cache"}).then(e=>e.json()).then(e=>P.remote(e)),{$subscribers:r}}return new class extends z{constructor(e){super(),E(this,e,K,J,i,[])}}({target:document.querySelector(".wrap")})}();
//# sourceMappingURL=bundle.js.map
